<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, user-scalable=no">
  <meta name="generator" content="made with love by dartdoc 1.0.0">
  <meta name="description" content="im_flutter_sdk API docs, for the Dart programming language.">
  <title>im_flutter_sdk - Dart API docs</title>


  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,300;0,400;0,500;0,700;1,400&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  
  <link rel="stylesheet" href="static-assets/github.css?v1">
  <link rel="stylesheet" href="static-assets/styles.css?v1">
  <link rel="icon" href="static-assets/favicon.png?v1">

  
</head>


<body data-base-href=""
      data-using-base-href="false">

<div id="overlay-under-drawer"></div>

<header id="title">
  <button id="sidenav-left-toggle" type="button">&nbsp;</button>
  <ol class="breadcrumbs gt-separated dark hidden-xs">
    <li><a href="http://www.easemob.com/product/im">im_flutter_sdk package</a></li>
  </ol>
  <div class="self-name">im_flutter_sdk</div>
  <form class="search navbar-right" role="search">
    <input type="text" id="search-box" autocomplete="off" disabled class="form-control typeahead" placeholder="Loading search...">
  </form>
</header>

<main>


  <div id="dartdoc-main-content" class="main-content">
      
<section class="desc markdown">
  <h2 id="im-flutter-sdk">环信im flutter sdk</h2>
<p>文章主要讲解环信im flutter sdk如何使用。</p>
<p><a href="https://www.easemob.com/">环信官网</a></p>
<p><a href="http://docs-im.easemob.com/im/ios/sdk/prepare">环信iOS集成文档</a></p>
<p><a href="http://docs-im.easemob.com/im/android/sdk/import">环信Android集成文档</a></p>
<p>源码地址: <a href="https://github.com/easemob/im_flutter_sdk">Github</a><br>
任何问题可以通过 <a href="https://github.com/easemob/im_flutter_sdk/issues">Github Issues</a> 提问</p>
<p>Demo中使用的音视频是针对声网音视频封装的<a href="https://github.com/easemob/ease_call_kit">EaseCallKit</a>,如果问题，可以通过 <a href="https://github.com/easemob/ease_call_kit/issues">EaseCallKit Issues</a> 提问</p>
<p><a href="https://github.com/easemob/im_flutter_sdk/blob/stable/docs/flutter_QA.md">常见问题</a></p>
<p><strong>QQ群: 535134817</strong></p>
<h2 id="">前期准备</h2>
<p>如果您还没有Appkey，可以前往<a href="https://www.easemob.com/">环信官网</a>注册<a href="https://console.easemob.com/user/register">即时通讯云</a>。</p>
<p>进入console -&gt; 添加应用 -&gt; Appkey 获取<code>Appkey</code>。</p>
<h4 id="git">通过git集成</h4>
<ol>
<li>修改 <code>pubspec.yaml</code>;</li>
</ol>
<pre class="language-dart"><code class="language-dart">dependencies:
  im_flutter_sdk:  
    git:  
      url: https://github.com/easemob/im_flutter_sdk.git 
      ref: stable
</code></pre>
<ol start="2">
<li>执行<code>flutter pub get</code>;</li>
<li>导入头文件:</li>
</ol>
<pre class="language-dart"><code class="language-dart">import 'package:im_flutter_sdk/im_flutter_sdk.dart'
</code></pre>
<h4 id="-2">本地集成</h4>
<ol>
<li>先将SDK clone 或者 download 到本地项目中;</li>
<li>修改 <code>pubspec.yaml</code>;</li>
</ol>
<pre class="language-dart"><code class="language-dart">dependencies:
  im_flutter_sdk:  
    path : /本地路径/im_flutter_sdk
</code></pre>
<ol start="3">
<li>执行<code>flutter pub get</code>;</li>
<li>导入头文件:</li>
</ol>
<pre class="language-dart"><code class="language-dart">import 'package:im_flutter_sdk/im_flutter_sdk.dart'
</code></pre>
<h2 id="sdk">SDK讲解</h2>
<ul>
<li><code>EMClient</code> 用于管理sdk各个模块和一些账号相关的操作，如注册，登录，退出;</li>
<li><code>EMChatManager</code>用于管理聊天相关操作，如发送消息，接收消息，发送已读回执，获取会话列表等;</li>
<li><code>EMContactManager</code> 用于管理通讯录相关操作，如获取通讯录列表，添加好友，删除好友等;</li>
<li><code>EMGroupManager</code>用于群组相关操作，如获取群组列表，加入群组，离开群组等;</li>
<li><code>EMChatRoomManager</code>用于管理聊天室，如获取聊天室列表;</li>
<li><code>EMPushManager</code>用于管理推送配置，如设置推送昵称，推送免打扰时间段等;</li>
<li><code>EMUserInfoManager</code>用于更新自己的用户属性，设置用户属性，获取其他用户的用户属性等;</li>
</ul>
<blockquote>
<p>SDK依赖环信Lite SDK，不支持音视频。</p>
</blockquote>
<h3 id="emclient">EMClient</h3>
<h4 id="-3">初始化</h4>
<pre class="language-dart"><code class="language-dart">EMOptions options = EMOptions(appKey: 'easemob-demo#chatdemoui');
EMPushConfig config = EMPushConfig();
// 配置推送信息
config
  ..enableAPNs("chatdemoui_dev")
  ..enableHWPush()
  ..enableFCM('')
  ..enableMeiZuPush('', '')
  ..enableMiPush('', '');
options.pushConfig = config;        
await EMClient.getInstance.init(options);
</code></pre>
<blockquote>
<p>环信的推送只针对离线设备，如果您的app只是后台且没有被系统挂起，此时客户端的长连接仍然还在，这时消息仍然会直接走收消息的方法，并不会触发推送，这就要求您在收消息时判断App的状态，并实现本地推送。<br>
推送证书申请上传，安卓端请参考文档<a href="http://docs-im.easemob.com/im/android/push/thirdpartypush#%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8E%A8%E9%80%81%E9%9B%86%E6%88%90">第三方推送集成</a>，iOS请参考文档<a href="http://docs-im.easemob.com/im/ios/apns/deploy">APNs推送</a>。</p>
</blockquote>
<h4 id="-4">注册</h4>
<pre class="language-dart"><code class="language-dart">try {
  await EMClient.getInstance.createAccount(username, password);
} on EMError catch (e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>客户端注册需要将注册方式设置为<code>开放注册</code>，具体说明请参考文档<a href="http://docs-im.easemob.com/im/server/ready/user#%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86">用户管理</a>。</p>
</blockquote>
<h4 id="-5">登录</h4>
<pre class="language-dart"><code class="language-dart">try {
  await EMClient.getInstance.login(username, password);
} on EMError catch (e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="id">获取当前登录环信id</h4>
<pre class="language-dart"><code class="language-dart">EMClient.getInstance.currentUsername;
</code></pre>
<h4 id="-6">退出</h4>
<pre class="language-dart"><code class="language-dart">try {
  // true: 是否解除deviceToken绑定。
  await EMClient.getInstance.logout(true);
} on EMError catch (e) {
  print('操作失败，原因是: $e');
}

</code></pre>
<blockquote>
<p>退出也有失败的情况，需要确定是否失败。<br>
注册环信id详细说明请参考文档<a href="http://docs-im.easemob.com/im/server/ready/user">用户体系集成</a>。</p>
</blockquote>
<h4 id="-7">监听服务器连接状态</h4>
<pre class="language-dart"><code class="language-dart">class _MyAppState extends State&lt;MyApp&gt; implements EMConnectionListener{
	
  @override
  void initState() {
    super.initState();
    // 添加连接监听
    EMClient.getInstance.addConnectionListener(this);
  }

	...

  @override
  void onConnected() {
    // 网络已连接
  }


  @override
  void onDisconnected(int errorCode) {
    // 连接失败，原因是[errorCode]	
  }
	
	...
	
  @override
  void dispose() {
    // 移除连接监听
    EMClient.getInstance.removeConnectionListener(this);
    super.dispose();
  }
}

</code></pre>
<h4 id="-8">获取当前连接状态</h4>
<pre class="language-dart"><code class="language-dart">EMClient.getInstance.connected;
</code></pre>
<h4 id="flutter-sdk">获取flutter sdk版本号</h4>
<pre class="language-dart"><code class="language-dart">EMClient.getInstance.flutterSDKVersion;
</code></pre>
<h3 id="emchatmanager">EMChatManager</h3>
<h4 id="-9">获取会话列表</h4>
<pre class="language-dart"><code class="language-dart">try {
  List&lt;EMConversation&gt; conList = await EMClient.getInstance.chatManager.loadAllConversations();
} on EMError catch (e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>会话列表是存在本地的一种消息管理对象，如果您会话中没有消息，则表示会话不存在。</p>
</blockquote>
<h4 id="-10">创建会话</h4>
<pre class="language-dart"><code class="language-dart">try {
  // emId: 会话对应环信id, 如果是群组或者聊天室，则为群组id或者聊天室id
  EMConversation conv = await EMClient.getInstance.chatManager.getConversation(emId);
} on EMError catch (e) {
  print('操作失败，原因是: $e');
}

</code></pre>
<h4 id="-11">获取会话中的消息</h4>
<pre class="language-dart"><code class="language-dart">try {
  List&lt;EMMessage&gt; msgs = con.loadMessages();
} on EMError catch (e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-12">获取会话中未读消息数</h4>
<pre class="language-dart"><code class="language-dart">con.unreadCount;
</code></pre>
<h4 id="-13">设置单条消息为已读</h4>
<pre class="language-dart"><code class="language-dart">try {
  con.markMessageAsRead(msg.msgId);
} on EMError catch (e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-14">设置所有消息为已读</h4>
<pre class="language-dart"><code class="language-dart">try {
  con.markAllMessagesAsRead();
} on EMError catch (e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-15">发送消息已读状态</h4>
<pre class="language-dart"><code class="language-dart">try {
  await EMClient.getInstance.chatManager.sendMessageReadAck(msg);
} on EMError catch (e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-16">删除会话中的消息</h4>
<pre class="language-dart"><code class="language-dart">try{
  // 删除会话中所有消息
  await conv.deleteAllMessages();
} on EMError catch (e) {
  print('操作失败，原因是: $e');
}

</code></pre>
<h4 id="-17">插入消息</h4>
<pre class="language-dart"><code class="language-dart">try{
  // 向会话中插入一条消息
  await conv.insertMessage(msg);
} on EMError catch (e) {
  print('操作失败，原因是: $e');
}

</code></pre>
<blockquote>
<p>SDK在您发送和接收消息(<em>cmd类型消息除外</em>)后会自动将消息插入数据库中，并不需要您自己将消息插入数据库，但如果您需要自己插入一条消息时可以调用该api。</p>
</blockquote>
<h4 id="-18">更新消息</h4>
<pre class="language-dart"><code class="language-dart">try{
  await conv.updateMessage(msg);
} on EMError catch (e) {
  print('操作失败，原因是: $e');
}

</code></pre>
<pre class="language-dart"><code class="language-dart">try{
  // 删除会话中某一条消息
  await conv.deleteMessage(msg.msgId);
} on EMError catch (e) {
  print('操作失败，原因是: $e');
}

</code></pre>
<h4 id="-19">删除会话</h4>
<pre class="language-dart"><code class="language-dart">try {
  await EMClient.getInstance.chatManager.deleteConversation(conversation.id);
} on EMError catch (e) {
  print('操作失败，原因是: $e');
}

</code></pre>
<p>​</p>
<h4 id="-20">构建要发送的消息</h4>
<pre class="language-dart"><code class="language-dart">// 文本消息
EMMessage msg = EMMessage.createTxtSendMessage(username: '接收方id', content: '消息内容');
	
// 图片消息
EMMessage msg = EMMessage.createImageSendMessage(username: '接收方id', filePath: '图片路径');
	
// 视频消息
EMMessage msg = EMMessage.createVideoSendMessage(username: '接收方id', filePath: '视频路径');
	
// 音频消息
EMMessage msg = EMMessage.createVoiceSendMessage(username: '接收方id', filePath: '语音路径');
	
// 位置消息
EMMessage msg = EMMessage.createLocationSendMessage(username: '接收方id', latitude: '纬度', longitude: '经度', address: '地址名称');
	
// cmd消息
EMMessage msg = EMMessage.createCmdSendMessage(username: '接收方id', action: '自定义事件');
	
// 自定义消息
EMMessage msg = EMMessage.createCustomSendMessage(username: '接收方id', event: '自定义事件');
</code></pre>
<blockquote>
<p>如果您是要构建群组或者聊天室消息，需要修改消息的<code>chatType</code>属性, 如:<br>
<code>msg.chatType = EMMessageChatType.GroupChat;</code></p>
</blockquote>
<h4 id="-21">发送消息</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.chatManager.sendMessage(msg);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-22">监听消息发送状态</h4>
<pre class="language-dart"><code class="language-dart">class ChatItemState extends State&lt;ChatItem&gt; implements EMMessageStatusListener {

  EMMessage msg;
  ...	
			
  void initState() {
    super.initState();
    // 添加监听
    msg.setMessageListener(this);
  }

	...
	
  // 消息进度
  @override
  void onProgress(int progress) {
  }

  // 消息发送失败
  @override
  void onError(EMError error) {
  }

  // 消息发送成功
  @override
  void onSuccess() {
	}
  
  // 消息已读
  @override
  void onReadAck() {
  }

  // 消息已送达
  @override
  void onDeliveryAck() {
  }
  
  // 消息状态发生改变
  @override
  void onStatusChanged() {
  }
	
  dispose(){
    msg.setMessageListener(null);
    super.dispose();
  }
	
}

</code></pre>
<h4 id="-23">重发消息</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.chatManager.resendMessage(message);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-24">撤回消息</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.chatManager.recallMessage(msg.msgId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}

</code></pre>
<blockquote>
<p>消息撤回为增值服务，您只能撤回2分钟内的消息，如需开通，请<a href="https://www.easemob.com/pricing/im#p08">咨询商务</a>。</p>
</blockquote>
<h4 id="-25">收消息监听</h4>
<pre class="language-dart"><code class="language-dart">
class _ChatPageState extends State&lt;ChatPage&gt; implements EMChatManagerListener {

  @override
  void initState() {
    super.initState();
    // 添加收消息监听
    EMClient.getInstance.chatManager.addListener(this);
  }

 
  // 收到cmd消息回调
  @override
  onCmdMessagesReceived(List&lt;EMMessage&gt; messages) {
  }

  // 会话列表数量变更
  @override
  onConversationsUpdate() {
  }

  // 消息已送达回调
  @override
  onMessagesDelivered(List&lt;EMMessage&gt; messages) {
  }

  // 消息已读回调
  @override
  onMessagesRead(List&lt;EMMessage&gt; messages) {
  }

  // 消息被撤回回调
  @override
  onMessagesRecalled(List&lt;EMMessage&gt; messages) {
  }

  // 收消息回调
  @override
  onMessagesReceived(List&lt;EMMessage&gt; messages) {
  }
  
  @override
  void dispose() {
    // 移除收消息监听
    EMClient.getInstance.chatManager.removeListener(this);
    super.dispose();
  }
}

</code></pre>
<h3 id="emcontactmanager">EMContactManager</h3>
<h4 id="-26">从服务器获取通讯录中的用户列表</h4>
<pre class="language-dart"><code class="language-dart">try{
  List&lt;EMContact&gt; contactsList = await EMClient.getInstance.contactManager.getAllContactsFromServer();
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>环信收发消息并不需要对方是您通讯录中的成员，只要知道对方的环信id就可以发送消息。</p>
</blockquote>
<h4 id="-27">发送添加申请</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.contactManager.addContact(friendEmId, '您好，我想添加您为好友');
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>添加申请不会发推送，如果用户不在线，等上线后会收到。</p>
</blockquote>
<h4 id="-28">删除通讯录中的成员</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.contactManager.deleteContact(friendEmId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-29">从服务器获取黑名单</h4>
<pre class="language-dart"><code class="language-dart">try{
  List&lt;EMContact&gt; blockList = await EMClient.getInstance.contactManager.getBlockListFromServer();
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-30">添加用户到黑名单中</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.contactManager.addUserToBlockList(emId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>黑名单和通讯录是独立的，被添加人不需要在您的通讯录中，如果是通讯录中成员被加入到黑名单后，他仍然会出现在您的通讯录名单中，同时他也会出现在您的黑名单中。被添加到黑名单后，您双方均无法收发对方的消息。</p>
</blockquote>
<h4 id="-31">将用户从黑名单中删除</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.contactManager.removeUserFromBlockList(emId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-32">通讯录监听</h4>
<pre class="language-dart"><code class="language-dart">class _ContactPageState extends State&lt;ContactPage&gt; implements EMContactEventListener {

  @override
  void initState() {
    super.initState();
    // 添加通讯录监听
    EMClient.getInstance.contactManager.addContactListener(this);
  }


  // [userName]添加您为好友
  @override
  onContactAdded(String userName) {
  }

  // [userName]将您从好友中删除
  @override
  onContactDeleted(String userName) {
  }
  
  // 收到[userName]的好友申请，原因是[reason]
  @override
  onContactInvited(String userName, String reason) {
  }
  
  // 发出的好友申请被[userName]同意
  @override
  onFriendRequestAccepted(String userName) {
  }
  
  // 发出的好友申请被[userName]拒绝
  @override
  onFriendRequestDeclined(String userName) {
  }

  @override
  void dispose() {
    // 移除通讯录监听
    EMClient.getInstance.contactManager.removeContactListener(this);
    super.dispose();
  }
}
</code></pre>
<h4 id="-33">同意添加申请</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.contactManager.acceptInvitation(emId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-34">拒绝添加申请</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.contactManager.declineInvitation(emId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h3 id="emgroupmanager">EMGroupManager</h3>
<h4 id="-35">从服务器获取已加入群组列表</h4>
<pre class="language-dart"><code class="language-dart">try{
  List&lt;EMGroup&gt; groupsList = await EMClient.getInstance.groupManager.getJoinedGroupsFromServer();
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}

</code></pre>
<h4 id="-36">从缓存中获取已加入群组列表</h4>
<pre class="language-dart"><code class="language-dart">try{
  List&lt;EMGroup&gt; groupsList = await EMClient.getInstance.groupManager.getJoinedGroups();
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}

</code></pre>
<h4 id="-37">从服务器获取公开群组列表</h4>
<pre class="language-dart"><code class="language-dart">try{
  List&lt;EMGroup&gt; groupsList = await EMClient.getInstance.groupManager.getPublicGroupsFromServer();
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-38">创建群组</h4>
<pre class="language-dart"><code class="language-dart">try{
  EMGroup group = await EMClient.getInstance.groupManager.createGroup('群组名称', settings: EMGroupOptions());
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>EMGroupOptions可以对群类型<code>EMGroupStyle</code>等参数进行设置，群组有四种，分别是:<br>
<code>PrivateOnlyOwnerInvite</code>私有群，只有群主和管理员能邀请他人进群，被邀请人会收到邀请信息，同意后可入群;<br>
<code>PrivateMemberCanInvite</code>私有群，所有人都可以邀请他人进群，被邀请人会收到邀请信息，同意后可入群;<br>
<code>PublicJoinNeedApproval</code>公开群，可以通过获取公开群列表api取的，申请加入时需要群主或管理员同意;<br>
<code>PublicOpenJoin</code>公开群，可以通过获取公开群列表api取，可以直接进入;</p>
</blockquote>
<h4 id="-39">获取群组详情</h4>
<pre class="language-dart"><code class="language-dart">try{
  EMGroup group = await EMClient.getInstance.groupManager.getGroupSpecificationFromServer(group.groupId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-40">获取群成员列表</h4>
<pre class="language-dart"><code class="language-dart">try{
  EMCursorResult result = await EMClient.getInstance.groupManager.getGroupMemberListFromServer(group.groupId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-41">加入公开群组</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.joinPublicGroup(groupId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>需要群组类型是<code>PublicOpenJoin</code>,调用后直接加入群组。</p>
</blockquote>
<h4 id="-42">申请加入公开群</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.requestToJoinPublicGroup(groupId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>需要群组类型是<code>PublicJoinNeedApproval</code>,申请后，群主和管理员会收到加群邀请，同意后入群。</p>
</blockquote>
<h4 id="-43">邀请用户入群</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.addMembers(groupId, inviteMembers);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>需要群组类型是<code>PrivateOnlyOwnerInvite</code>或<code>PrivateMemberCanInvite</code>,<br>
<code>PrivateOnlyOwnerInvite</code>时，群主和管理员可以调用；<br>
<code>PrivateMemberCanInvite</code>是，群中任何人都可以调用；<br>
被邀请方会收到邀请通知，同意后进群。邀请通知并不会以推送的形式发出，如果用户不在线，等上线后会收到，用户同意后入群。</p>
</blockquote>
<h4 id="-44">从群组中移除用户</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.removeMembers(groupId, members);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>群主和管理员可以调用。</p>
</blockquote>
<h4 id="-45">添加管理员</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.addAdmin(groupId, memberId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>群主可以调用。被操作人会收到被添加为管理员回调，该回调无推送，如用户不在线，上线后会收到。</p>
</blockquote>
<h4 id="-46">移除管理员</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.removeAdmin(groupId, memberId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>群主可以调用。被操作人会收到被移除管理员回调，该回调无推送，如用户不在线，上线后会收到。</p>
</blockquote>
<h4 id="-47">退出群组</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.leaveGroup(groupId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-48">解散群组</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.destroyGroup(groupId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>只有群主可以调用。</p>
</blockquote>
<h4 id="-49">转移群组</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.changeGroupOwner(groupId, newOwner);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>只有群主可以调用。</p>
</blockquote>
<h4 id="-50">获取群组黑名单列表</h4>
<pre class="language-dart"><code class="language-dart">try{
  List blockList = await EMClient.getInstance.groupManager.getGroupBlocklistFromServer(group.groupId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-51">将群成员添加到群黑名单</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.blockMembers(group.groupId, blockList);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>该方法只有群主和管理员可以调用，被操作用户当前必须是群成员，当用户被加入到群黑名单后，该用户将从群成员中移除并加入到当前群的黑名单中。同时该用户将无法再进入该群。</p>
</blockquote>
<h4 id="-52">将用户从黑名单移除</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.unblockMembers(group.groupId, unBlockList);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>该方法只有群主和管理员可以调用，当账号从黑名单中移除后可以再允许申请加群。</p>
</blockquote>
<h4 id="-53">获取群禁言列表</h4>
<pre class="language-dart"><code class="language-dart">try{
  List mutesList = await EMClient.getInstance.groupManager.getGroupMuteListFromServer(group.groupId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-54">对成员禁言</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.muteMembers(group.groupId, mutesList);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>该方法只有群主和管理员可以调用，被禁言的用户仍然可以收到群中的消息，但是无法发出消息， 白名单中的用户即使被加入到禁言列表中也不受影响。</p>
</blockquote>
<h4 id="-55">对成员解除禁言</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.unMuteMembers(group.groupId, unMutesList);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>该方法只有群主和管理员可以调用。</p>
</blockquote>
<h4 id="-56">对所有成员禁言</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.muteAllMembers(group.groupId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>该方法只有群主和管理员可以调用，对群主，管理员，白名单中的成员无效，且针对所有人的<code>禁言</code>操作与<code>muteMembers</code>、<code>unMuteMembers</code>接口不冲突，该接口的操作并不会导致<code>getGroupMuteListFromServer</code>接口的返回的数据变化。</p>
</blockquote>
<h4 id="-57">对所有成员解除禁言</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.unMuteAllMembers(group.groupId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>该方法只有群主和管理员可以调用，且针对所有人的<code>解除禁言</code>操作与<code>muteMembers</code>、<code>unMuteMembers</code>接口不冲突，该接口的操作并不会导致<code>getGroupMuteListFromServer</code>接口的返回的数据变化。当调用该方法后，之前在禁言列表中的用户仍在禁言列表中，且仍处于禁言状态。</p>
</blockquote>
<h4 id="-58">获取白名单列表</h4>
<pre class="language-dart"><code class="language-dart">try{
  List whiteList = await EMClient.getInstance.groupManager.getGroupWhiteListFromServer(group.groupId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-59">将用户添加到白名单中</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.addWhiteList(group.groupId, whiteList);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>该方法只有群主和管理员可以调用，当用户被加入到白名单后，当群组全部禁言或者被添加到禁言列表后仍可以发言。</p>
</blockquote>
<h4 id="-60">将用户从白名单中移除</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.removeWhiteList(group.groupId, whiteList);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>该方法只有群主和管理员可以调用。</p>
</blockquote>
<h4 id="-61">判断自己是否在白名单中</h4>
<pre class="language-dart"><code class="language-dart">try{
  bool inWhiteList = await EMClient.getInstance.groupManager.isMemberInWhiteListFromServer(group.groupId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-62">不接收群消息</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.blockGroup(group.groupId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>设置后群组中的所有消息都无法收到，用户不在线时也不会有推送告知。</p>
</blockquote>
<h4 id="-63">恢复接收群消息</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.unblockGroup(group.groupId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-64">消息免打扰</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.ignoreGroupPush(group.groupId, true);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>设置后用户在线时可以正常接收群消息，当用户不在线时，该群组有新消息时不会有推送告知。</p>
</blockquote>
<h4 id="-65">更新群名称</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.changeGroupName(group.groupId, newName);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>群主或管理员可以调用。</p>
</blockquote>
<h4 id="-66">更新群描述</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.changeGroupDescription(group.groupId, newDescription);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>群主或管理员可以调用。</p>
</blockquote>
<h4 id="-67">获取群组公告</h4>
<pre class="language-dart"><code class="language-dart">try{
  String announcement = await EMClient.getInstance.groupManager.getGroupAnnouncementFromServer(group.groupId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-68">更新群公告</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.updateGroupAnnouncement(group.groupId, announcement);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>群主或管理员可以调用。</p>
</blockquote>
<h4 id="-69">获取群共享文件列表</h4>
<pre class="language-dart"><code class="language-dart">try{
  List&lt;EMGroupSharedFile&gt; filesList = await EMClient.getInstance.groupManager.getGroupFileListFromServer(group.groupId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-70">上传群共享文件</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.uploadGroupSharedFile(group.groupId, filePath);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-71">下载群共享文件</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.uploadGroupSharedFile(group.groupId, groupSharedFile.fileId, savePath: path);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-72">删除群共享文件</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.removeGroupSharedFile(group.groupId, groupSharedFile.fileId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>群主，管理员，文件上传者可以调用。</p>
</blockquote>
<h4 id="-73">群回调监听</h4>
<pre class="language-dart"><code class="language-dart">class _GroupPageState extends State&lt;GroupPage&gt; implements EMGroupChangeListener {

  @override
  void initState() {
    super.initState();
    // 添加群组监听
    EMClient.getInstance.groupManager.addGroupChangeListener(this);
  }

	...

  // id是[groupId], 名称是[groupName]的群邀请被[inviter]拒绝,理由是[reason]
  void onInvitationReceived(String groupId, String groupName, String inviter, String reason) {
  }

  // 收到用户[applicant]申请加入id是[groupId], 名称是[groupName]的群，原因是[reason]
  void onRequestToJoinReceived(String groupId, String groupName, String applicant, String reason) {
  }

  // 入群申请被同意
  void onRequestToJoinAccepted(String groupId, String groupName, String accepter) {
  }

  // 入群申请被拒绝
  void onRequestToJoinDeclined(String groupId, String groupName, String decliner, String reason) {
  }

  // 入群邀请被同意
  void onInvitationAccepted(String groupId, String invitee, String reason) {
  }

  // 入群邀请被拒绝
  void onInvitationDeclined(String groupId, String invitee, String reason) {
  }

  // 被移出群组
  void onUserRemoved(String groupId, String groupName) {
  }

  // 群组解散
  void onGroupDestroyed(String groupId, String groupName) {
  }

  // 自动同意加群
  void onAutoAcceptInvitationFromGroup(String groupId, String inviter, String inviteMessage) {
  }

  // 群禁言列表增加
  void onMuteListAdded(String groupId, List mutes, int muteExpire) {
  }

  // 群禁言列表减少
  void onMuteListRemoved(String groupId, List mutes) {
  }

  // 群管理增加
  void onAdminAdded(String groupId, String administrator) {
  }

  // 群管理被移除
  void onAdminRemoved(String groupId, String administrator) {
  }

  // 群所有者变更
  void onOwnerChanged(String groupId, String newOwner, String oldOwner) {
  }

  // 有用户加入群
  void onMemberJoined(String groupId, String member) {
  }

  // 有用户离开群
  void onMemberExited(String groupId, String member) {
  }

  // 群公告变更
  void onAnnouncementChanged(String groupId, String announcement) {
  }

  // 群共享文件增加
  void onSharedFileAdded(String groupId, EMGroupSharedFile sharedFile) {
  }

  // 群共享文件被删除
  void onSharedFileDeleted(String groupId, String fileId) {
  }

	...
   
  @override
  void dispose() {
    // 移除群组监听
    EMClient.getInstance.groupManager.removeGroupChangeListener(this);
    super.dispose();
  }
}

</code></pre>
<h4 id="-74">同意加群申请</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.acceptJoinApplication(group.groupId, username);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>群主和管理员可以调用。</p>
</blockquote>
<h4 id="-75">拒绝加群申请</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.declineJoinApplication(group.groupId, username);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>群主和管理员可以调用。</p>
</blockquote>
<h4 id="-76">同意加群邀请</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.declineJoinApplication(group.groupId, inviter);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-77">拒绝加群邀请</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.groupManager.declineInvitationFromGroup(group.groupId, inviter);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h3 id="emchatroommanager">EMChatRoomManager</h3>
<h4 id="-78">从服务器获取聊天室列表</h4>
<pre class="language-dart"><code class="language-dart">try{
  EMPageResult result = await EMClient.getInstance.roomManager.fetchPublicChatRoomsFromServer();
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-79">获取本地缓存聊天室列表</h4>
<pre class="language-dart"><code class="language-dart">try{
  List&lt;EMChatRoom&gt; list = await EMClient.getInstance.roomManager.getAllChatRooms();
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-80">创建聊天室</h4>
<pre class="language-dart"><code class="language-dart">try{
  EMChatRoom room = await EMClient.getInstance.roomManager.createChatRoom('聊天室名称');
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>聊天室创建需要单独拥有权限，具体可以参考文档<a href="http://docs-im.easemob.com/im/server/basics/chatroom">聊天室管理</a>。</p>
</blockquote>
<h4 id="-81">加入聊天室</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.roomManager.joinChatRoom(roomId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-82">离开聊天室</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.roomManager.leaveChatRoom(roomId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-83">销毁聊天室</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.roomManager.destroyChatRoom(roomId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>聊天室销毁需要单独拥有权限，具体可以参考文档<a href="http://docs-im.easemob.com/im/server/basics/chatroom">聊天室管理</a>。</p>
</blockquote>
<h4 id="-84">转移聊天室</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.roomManager.changeOwner(roomId, newOwner);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>聊天室转移需要单独拥有权限，具体可以参考文档<a href="http://docs-im.easemob.com/im/server/basics/chatroom">聊天室管理</a>。</p>
</blockquote>
<h4 id="-85">获取聊天室详情</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.roomManager.fetchChatRoomInfoFromServer(roomId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-86">获取聊天室成员</h4>
<pre class="language-dart"><code class="language-dart">try{
  EMCursorResult result = await EMClient.getInstance.roomManager.fetchChatRoomMembers(roomId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-87">移除聊天室成员</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.roomManager.removeChatRoomMembers(roomId, membersList);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>创建者或管理员调用。</p>
</blockquote>
<h4 id="-88">添加管理员</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.roomManager.addChatRoomAdmin(roomId, memberId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>创建者调用，被操作者会收到回调。</p>
</blockquote>
<h4 id="-89">移除管理员</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.roomManager.removeChatRoomAdmin(roomId, adminId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>创建者调用，被操作者会收到回调。</p>
</blockquote>
<h4 id="-90">获取禁言列表</h4>
<pre class="language-dart"><code class="language-dart">try{
  List&lt;String&gt; mutesList = await EMClient.getInstance.roomManager.fetchChatRoomMuteList(roomId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-91">设置禁言</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.roomManager.muteChatRoomMembers(roomId, membersList);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>创建者或者管理员调用。</p>
</blockquote>
<h4 id="-92">解除禁言</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.roomManager.unMuteChatRoomMembers(roomId, membersList);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>创建者或者管理员调用。</p>
</blockquote>
<h4 id="-93">获取黑名单列表</h4>
<pre class="language-dart"><code class="language-dart">try{
  List&lt;String&gt; blockList = await EMClient.getInstance.roomManager.fetchChatRoomBlockList(roomId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-94">添加黑名单</h4>
<pre class="language-dart"><code class="language-dart">try{
  List&lt;String&gt; blockList = await EMClient.getInstance.roomManager.blockChatRoomMembers(roomId, membersList);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>创建者或管理员调用。</p>
</blockquote>
<h4 id="-95">移除黑名单</h4>
<pre class="language-dart"><code class="language-dart">try{
  List&lt;String&gt; blockList = await EMClient.getInstance.roomManager.unBlockChatRoomMembers(roomId, membersList);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>创建者或管理员调用。</p>
</blockquote>
<h4 id="-96">修改聊天室标题</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.roomManager.changeChatRoomSubject(roomId, subject);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>创建者或管理员调用。</p>
</blockquote>
<h4 id="-97">修改聊天室描述</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.roomManager.changeChatRoomDescription(roomId, desc);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>创建者或管理员调用。</p>
</blockquote>
<h4 id="-98">获取聊天室公告</h4>
<pre class="language-dart"><code class="language-dart">try{
  String announcement = await EMClient.getInstance.roomManager.fetchChatRoomAnnouncement(roomId);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-99">修改聊天室公告</h4>
<pre class="language-dart"><code class="language-dart">try{
  await EMClient.getInstance.roomManager.updateChatRoomAnnouncement(roomId, announcement);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>创建者或管理员调用</p>
</blockquote>
<h4 id="-100">添加聊天室监听</h4>
<pre class="language-dart"><code class="language-dart">
class _RoomPageState extends State&lt;RoomPage&gt; implements EMChatRoomEventListener {

  @override
  void initState() {
    super.initState();
    // 添加聊天室监听
    EMClient.getInstance.roomManager.addChatRoomChangeListener(this);
  }
  
  /// id是[roomId],名称是[roomName]的聊天室被销毁
  void onChatRoomDestroyed(String roomId, String roomName) {
  }

  /// 有用户[participant]加入id是[roomId]的聊天室
  void onMemberJoined(String roomId, String participant) {
  }

  /// 有用户[participant]离开id是[roomId]，名字是[roomName]的聊天室
  void onMemberExited(String roomId, String roomName, String participant) {
  }

  /// 用用户[participant]被id是[roomId],名称[roomName]的聊天室删除，删除原因是[reason]
  void onRemovedFromChatRoom(int reason, String roomId, String roomName, String participant) {
  }

  /// id是[roomId]的聊天室禁言列表[mutes]有增加
  void onMuteListAdded(String roomId, List mutes, String expireTime) {
  }

  /// id是[roomId]的聊天室禁言列表[mutes]有减少
  void onMuteListRemoved(String roomId, List mutes) {
  }

  /// id是[roomId]的聊天室增加id是[admin]管理员
  void onAdminAdded(String roomId, String admin) {
  }

  /// id是[roomId]的聊天室移除id是[admin]管理员
  void onAdminRemoved(String roomId, String admin) {
  }

  /// id是[roomId]的聊天室所有者由[oldOwner]变更为[newOwner]
  void onOwnerChanged(String roomId, String newOwner, String oldOwner) {
  }

  /// id是[roomId]的聊天室公告变为[announcement]
  void onAnnouncementChanged(String roomId, String announcement) {
  }

   @override
  void dispose() {
    // 移除聊天室监听
    EMClient.getInstance.roomManager.removeChatRoomListener(this);
    super.dispose();
  }
}

</code></pre>
<h3 id="-101">推送</h3>
<h4 id="-102">设置推送昵称</h4>
<pre class="language-dart"><code class="language-dart">try{
  String announcement = await EMClient.getInstance.pushManager.updatePushNickname(pushName);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>推送昵称是指当前账号给其他用户发消息，对方不在线，收到推送时显示在推送中的名字，如果没设置，将显示环信id。</p>
</blockquote>
<h4 id="-103">从服务器获取推送配置</h4>
<pre class="language-dart"><code class="language-dart">try{
  EMImPushConfig pushManager = await EMClient.getInstance.pushManager.getImPushConfigFromServer();
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-104">从本地缓存获取推送配置</h4>
<pre class="language-dart"><code class="language-dart">try{
  EMImPushConfig pushConfig = await EMClient.getInstance.pushManager.getImPushConfig();
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-105">设置推送显示样式</h4>
<pre class="language-dart"><code class="language-dart">try{
  await pushConfig.setPushStyle(EMImPushStyle.Simple);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p><code>EMImPushStyle</code>是收推送时样式，目前有两种样式：<br>
<code>Simple</code>显示“您有一条新消息”;<br>
<code>Summary</code>显示推送详情;</p>
</blockquote>
<h4 id="-106">设置消息免打扰</h4>
<pre class="language-dart"><code class="language-dart">try{
  await pushConfig.setNoDisturb(true, 10, 22);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<blockquote>
<p>10点到22点之间不接收消息推送。如果是全天不想接收推送，可以设置时间为<code>0</code>到<code>24</code>。</p>
</blockquote>
<h4 id="-107">关闭消息免打扰</h4>
<pre class="language-dart"><code class="language-dart">try{
  await pushConfig.setNoDisturb(false);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-108">设置群组免打扰</h4>
<pre class="language-dart"><code class="language-dart">try{
  await pushConfig.setGroupToDisturb(groupId, true);
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h4 id="-109">获取免打扰群组列表</h4>
<pre class="language-dart"><code class="language-dart">try{
  List groupIdsList = await pushConfig.noDisturbGroupsFromServer();
} on EMError catch(e) {
  print('操作失败，原因是: $e');
}
</code></pre>
<h3 id="emuserinfomanager">EMUserInfoManager</h3>
<h4 id="-110">更新自己的用户属性</h4>
<pre class="language-dart"><code class="language-dart"> try {
     
      Map aMap = {'nickName': 'gagaga', 'mail': 'jinliang.liu@easemob.com'};
      EMUserInfo updateUserInfo =
          await EMClient.getInstance.userInfoManager.updateOwnUserInfo(aMap);
    } on EMError catch (e) {
      print('操作失败，原因是: $e');
    }
</code></pre>
<h4 id="-111">更新自己的某一个用户属性</h4>
<pre class="language-dart"><code class="language-dart">   try {
      EMUserInfoType infoType = EMUserInfoType.EMUserInfoTypeBirth;
      String updateValue = '2021.01.01';
      EMUserInfo updateUserInfo = await EMClient.getInstance.userInfoManager
          .updateOwnUserInfoWithType(infoType, updateValue);
    } on EMError catch (e) {
      print('操作失败，原因是: $e');
    }
</code></pre>
<h4 id="-112">获取多用户的用户属性</h4>
<pre class="language-dart"><code class="language-dart">  try {
      String userId = EMClient.getInstance.currentUsername;
      List&lt;String&gt; userIds =[];
      userIds.add(userId);
      userIds.add('xxx');
      
      int expireTime = DateTime.fromMillisecondsSinceEpoch(
              DateTime.now().millisecondsSinceEpoch - 10000000)
          .millisecondsSinceEpoch;

      Map userInfoMap = await EMClient.getInstance.userInfoManager
          .fetchUserInfoByIdWithExpireTime(userIds, expireTime: expireTime);


    } on EMError catch (e) {
      print('操作失败，原因是: $e');
    }
</code></pre>
<h4 id="-113">获取多用户指定的用户属性</h4>
<pre class="language-dart"><code class="language-dart">try {
      String userId = EMClient.getInstance.currentUsername;
      List&lt;String&gt; userIds =[];
      userIds.add(userId);
      userIds.add('xxx');

      List&lt;EMUserInfoType&gt; types =[];
      types.add(EMUserInfoType.EMUserInfoTypeNickName);
      types.add(EMUserInfoType.EMUserInfoTypeBirth);


      int expireTime = DateTime.fromMillisecondsSinceEpoch(
              DateTime.now().millisecondsSinceEpoch - 10000000)
          .millisecondsSinceEpoch;

      Map userInfoMap = await EMClient.getInstance.userInfoManager
          .fetchUserInfoByIdWithType(userIds, types, expireTime: expireTime);


    } on EMError catch (e) {
      print('操作失败，原因是: $e');
    }
</code></pre>
</section>


      <section class="summary">
          <h2>Libraries</h2>
        <dl>
          <dt id="im_flutter_sdk">
  <span class="name"><a href="im_flutter_sdk/im_flutter_sdk-library.html">im_flutter_sdk</a></span> 

</dt>
<dd> 
</dd>

        </dl>
      </section>

  </div> <!-- /.main-content -->

  <div id="dartdoc-sidebar-left" class="sidebar sidebar-offcanvas-left">
    <header id="header-search-sidebar" class="hidden-l">
  <form class="search-sidebar" role="search">
    <input type="text" id="search-sidebar" autocomplete="off" disabled class="form-control typeahead" placeholder="Loading search...">
  </form>
</header>

<ol class="breadcrumbs gt-separated dark hidden-l" id="sidebar-nav">
  <li><a href="http://www.easemob.com/product/im">im_flutter_sdk package</a></li>
</ol>


    <h5 class="hidden-xs"><span class="package-name">im_flutter_sdk</span> <span class="package-kind">package</span></h5>
    <ol>
      <li class="section-title">Libraries</li>
      <li><a href="im_flutter_sdk/im_flutter_sdk-library.html">im_flutter_sdk</a></li>
</ol>

  </div>

  <div id="dartdoc-sidebar-right" class="sidebar sidebar-offcanvas-right">
  </div>

</main>

<footer>
  <span class="no-break">
    im_flutter_sdk
      1.0.0
  </span>

  
</footer>



<script src="static-assets/highlight.pack.js?v1"></script>
<script src="static-assets/script.js?v1"></script>



</body>

</html>

